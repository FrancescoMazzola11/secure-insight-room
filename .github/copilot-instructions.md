# Secure Insight Room - AI Development Guide

## Project Overview
This is a **secure data room application** built with React + TypeScript + Vite, focusing on document management with user permissions and audit trails. Think of it as a secure file sharing platform for sensitive business documents (financial, legal, tax).

## Architecture & Tech Stack
- **Frontend**: React 18 + TypeScript + Vite + React Router
- **UI**: shadcn/ui components + Tailwind CSS + Radix UI primitives
- **Database**: SQLite (dev) with Drizzle ORM + future PostgreSQL migration path
- **State**: TanStack Query for server state + local React state
- **Build**: Vite with SWC for fast compilation

## Database Architecture
The app centers around **data rooms** (secure document containers):
```
users → dataRooms → files/folders
     ↘ permissions ↗     ↓
       userDataRoomPermissions → fileAccessLogs
```

Key tables in `src/lib/schema.ts`:
- `dataRooms`: Main containers with creator, tags, timestamps
- `userDataRoomPermissions`: Role-based access (Creator/Editor/Contributor/Viewer)
- `files`: Documents with encryption metadata, virus scan status
- `fileAccessLogs`: Complete audit trail of all file access

## Development Patterns

### Database Operations
Use service classes in `src/lib/services.ts` instead of direct DB queries:
```typescript
// Good: Use services
const dataRooms = await DataRoomService.findByUserId(userId);
// Avoid: Direct queries in components
```

### Component Structure
- Pages in `src/pages/` handle routing and data fetching
- Reusable components in `src/components/` organized by domain (`dashboard/`, `layout/`)
- UI primitives in `src/components/ui/` (auto-generated by shadcn/ui)

### State Management
- Use TanStack Query for server state (already configured in `App.tsx`)
- Local state with `useState` for UI-only concerns
- Form state with React Hook Form + Zod validation

### Styling Conventions
- Use `cn()` utility from `src/lib/utils.ts` for conditional classes
- Prefer shadcn/ui components over custom styling
- Tailwind classes with semantic naming (example: `text-muted-foreground`)

## Development Workflow

### Database Changes
```bash
# 1. Update schema in src/lib/schema.ts
# 2. Generate migration
npm run db:generate
# 3. Apply to database
npm run db:push
# 4. View data (optional)
npm run db:studio
```

### Adding New Features
1. Define types in `src/lib/schema.ts`
2. Add service methods in `src/lib/services.ts`
3. Create page component in `src/pages/`
4. Add route in `src/App.tsx`
5. Add any reusable components to `src/components/`

### Essential Commands
```bash
npm run dev          # Start dev server (port 8080)
npm run db:seed      # Populate with sample data
npm run db:studio    # Visual database browser
```

## Security Patterns
- All file operations must log to `fileAccessLogs`
- User permissions checked via `userDataRoomPermissions` table
- Files have encryption status tracking (`isEncrypted`, `encryptionKey`)
- Virus scanning status tracked per file

## Integration Points
- **File Storage**: Prepared for cloud storage (S3-compatible)
- **Authentication**: Schema includes password hashing, ready for auth integration
- **Audit**: Comprehensive logging for compliance requirements
- **Database Migration**: Ready to switch from SQLite to PostgreSQL

## Common Gotchas
- Always use absolute imports with `@/` alias
- Database uses UUID primary keys, not auto-increment
- Timestamps are stored as Unix epochs (`integer` mode)
- File paths in database are relative to storage root
- Permission roles: Creator > Editor > Contributor > Viewer